<div class="expense-history-section">
  <h2 class="section-header">Expense History</h2>

  <div *ngIf="expenseService.expenses().length === 0" class="no-expenses">
    <mat-card>
      <mat-card-content>
        <div class="empty-state">
          <mat-icon>receipt_long</mat-icon>
          <p>No expenses recorded yet.</p>
          <p class="subtitle">Add your first expense above!</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div *ngIf="expenseService.expenses().length > 0">
    <div class="total-summary">
      <mat-card>
        <mat-card-content>
          <div class="summary-content">
            <div class="summary-info">
              <strong>Total Expenses: {{getTotalExpenses()}}</strong>
              <span class="expense-count">{{expenseService.expenses().length}} expense(s)</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <mat-accordion class="expense-accordion">
      <mat-expansion-panel 
        *ngFor="let expense of expenseService.expenses(); trackBy: trackByExpenseId"
        class="expense-panel"
        [ngClass]="{'settlement-panel': expense.isSettlement}">
        
        <mat-expansion-panel-header>
          <mat-panel-title>
            <div class="expense-title">
              <mat-icon *ngIf="expense.isSettlement" class="settlement-icon" color="primary">account_balance_wallet</mat-icon>
              <strong>{{expense.description}}</strong>
              <span class="expense-amount" *ngIf="!expense.isSettlement">{{formatCurrency(expense.amount)}}</span>
              <span class="settlement-badge" *ngIf="expense.isSettlement">Settlement</span>
            </div>
          </mat-panel-title>
          <mat-panel-description>
            <span *ngIf="!expense.isSettlement">Paid by {{getParticipantName(expense.paidBy)}} â€¢ {{formatDate(expense.date)}}</span>
            <span *ngIf="expense.isSettlement">{{formatDate(expense.date)}}</span>
          </mat-panel-description>
        </mat-expansion-panel-header>

        <!-- Regular Expense Details -->
        <div class="expense-details" *ngIf="!expense.isSettlement">
          <div class="detail-row">
            <span class="label">Amount:</span>
            <span class="value">{{formatCurrency(expense.amount)}}</span>
          </div>
          
          <div class="detail-row">
            <span class="label">Paid by:</span>
            <span class="value">{{getParticipantName(expense.paidBy)}}</span>
          </div>
          
          <div class="detail-row">
            <span class="label">Date:</span>
            <span class="value">{{formatDate(expense.date)}}</span>
          </div>
          
          <div class="detail-row">
            <span class="label">Split among:</span>
            <div class="participants-list">
              <mat-chip-set>
                <mat-chip *ngFor="let participantId of expense.splitAmong" class="participant-chip">
                  {{getParticipantName(participantId)}}
                </mat-chip>
              </mat-chip-set>
            </div>
          </div>
          
          <div class="detail-row">
            <span class="label">Amount per person:</span>
            <span class="value amount-per-person">{{formatCurrency(calculateSplitAmount(expense))}}</span>
          </div>
          
          <div class="expense-actions">
            <button 
              mat-button 
              color="warn" 
              (click)="removeExpense(expense.id)"
              class="delete-button">
              <mat-icon>delete</mat-icon>
              Delete Expense
            </button>
          </div>
        </div>

        <!-- Settlement Details -->
        <div class="settlement-details" *ngIf="expense.isSettlement && expense.settlementDetails">
          <div class="settlement-intro">
            <p>The following payments were made to settle all outstanding balances:</p>
          </div>
          
          <div class="settlement-payments">
            <div *ngFor="let settlement of expense.settlementDetails" class="settlement-payment-item">
              <div class="payment-from-to">
                <strong>{{getParticipantName(settlement.fromParticipant)}}</strong>
                <mat-icon class="payment-arrow">arrow_forward</mat-icon>
                <strong>{{getParticipantName(settlement.toParticipant)}}</strong>
              </div>
              <div class="payment-amount">
                {{formatCurrency(settlement.amount)}}
              </div>
            </div>
          </div>
          
          <div class="detail-row">
            <span class="label">Settlement date:</span>
            <span class="value">{{formatDate(expense.date)}}</span>
          </div>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
  </div>
</div>
